arexx2hass

il s'agit d'un pont Mqtt entre HomeAssistant et les matériels Arexx BS10xx et bs5xx.
Le mode découverte est activé par défaut, mais les informations ne sont transmises à Homeassistant qu'après une validation.

Utilisation avec ha
la validation s'effectue au traverrs d'un objet spécifique dans ha.
Cet objet est accessible par les menus
paramètres->Appareils et services->MQTT->appareils->New Arexx
2 boites nous intéressent:
- configuration
- diagnostic
dans la boite configuration:
- sélectionner l'arexx device par son numéro,
- remplir les champs 'name' et 'suggested Area',  ex: Température et Salon
- cliquer sur 'appuyer' de 'add/modify'

Le capteur est alors envoyé à ha et affecté à la pièce indiquée.
Pourquoi la saisie de ces données ? pour les reconnaitre immédiatement dans le paramétrage de arexx2hass (config/devices.yml),
et affecter un nom complet à l'entity_id de ha.

Installation
Ce module peut être installé 
- soit directement par clonage git sur votre machine
- soit par docker (installation conseillée) sur des machines x86/amd64 ou arm64. Il n'existe pas de version pour les armv7 pour l'instant.
- pas encore par NPM
Sur les installation Docker, utilisez le fichier compose.yml ci dessous que vous devez adapter à votre environnement
version: "0.1.0"
services: 
  arexx2mqtt:
    image: zdid2/arexx2hass:latest
    container_name: arexx2hass
    privileged: true
    volumes:
      - ./data:/app/data
    environment:
      AREXX2HASS_MQTT_SERVER: localhost
      ARREXX2HASS_MQTT_USER: youruser
      ARREXX2HASS_MQTT_PASSWORD: passwd
      TZ: Europe/Paris
    restart: unless-stopped 
    #devices:
      #- /dev/ttyUSB0:/dev/ttyUSB0

personnalisez les contenus de "volumes" et "environment".
lors du premier démarrage une copie des fichiers de configuration sont rendus accessibles sur ./data
ensuite vous pourrez agir sur le fchier config.yml
Le fichier devices.yml contient les données de paramétrage pour ha des capteurs Arexx détectés.
Installation sur bs1000 
2 possibilités:
1) méthode conseillée: positionner par accès au bs1000 mode administrateur, un fichier avec la contenu suivant:

Vrulefile
A1push to templogger
B2
C0
E<ADRESSE DE AREXX2HASS>:49161/rules
Ztype==$q&&id==$i&&time==$S&&v==$v&&rssi==$r&&missing==$w

2) sinon (plus facile et non conseillé) indiquer par paramétrage l'adresse réseau du bs1000 par la boite de paramétrage de arexx2hass (address):
  paramètres->Appareils et services->MQTT->appareils->ArexxBridge

Installation avec un BS5xx
le BS5xx doit être raccordé à un rpi avec un système d'exploitation qui reconnaisse le BS5xx (bullseye), car les plus récents ne le reconnaissent pas (incident à soumettre à Arexx)
sur le site d'arexx il faut télécharger le module spécifique  rf_usb_http_rpi_0_6 (aussi présent dans le répertoire linux). Voir sur github
comme pour le le BS1xxx le fichier rulefile.txt est nécessaire mais aussi le fichier device.xml.
Lorsque Arexx aurra régler le problème d'assignation du périphérique USB, le module pourra être exécuté directement sur le docker.   


